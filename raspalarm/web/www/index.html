<html>
    <head>
        <title>RaspAlarm Portal</title>
        <script src="/jquery-2.1.1.min.js"></script>
        <script>
        $(function(){
            $('button').on('click', process_request);
        });

        var process_request = function(evt){
            evt.preventDefault()
            switch($(this).attr('id')){
                case 'startstream':
                    start_stream();
                    break;
                case 'stopstream':
                    stop_stream();
                    break;
            }
        }

        STREAMING = false;
        STREAM_NUM_IMAGE = 0;

        var start_stream = function(){
            $.ajax('/start_streaming', {
                success: function(data){
                    if(data.success){
                        STREAMING = true;
                        get_image();
                     }else{
                         alert(data.error);
                     }
                }
            });
        };

        var get_image = function(){
            if(STREAMING){
                var thisnum = STREAM_NUM_IMAGE++;
                var url = '/get_stream_image?_='+(thisnum);
                var img = $('<img>')
                    .css('zIndex', '-1')
                    .css('position', 'absolute')
                    .attr('src', url);
                img.one('load', function(){
                    $(this).css('zIndex', thisnum);
                    $('.old').remove();
                    get_image();
                }).each(function(){
                    if(this.complete){
                        $(this).load();
                    }
                });
                var stream = $('.stream');
                stream.find('img').addClass('old');
                img.appendTo(stream);
            }
        }

        var stop_stream = function(){
            STREAMING = false;
            $.ajax('/stop_streaming', {
                success: function(data){
                    if(!data.success){
                        alert('Error!');
                        alert(data);
                    }
                }
            });
        }

        </script>
        <style>
            .stream {
                height: 600;
                widht: 800;
            }
            .buttons {
                width: 100%;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <div class="stream">

        </div>
        <div class="buttons">
            <button id="startstream">Start streaming!</button>
            <button id="stopstream">Stop streaming!</button>
        </div>
    </body>
</html>
